<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.149">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>PM2.5 Sensor Offset Fault Prediction – pm_notebook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">PM2.5 Sensor Offset Fault Prediction</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Exploration</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./model_page.html">Offset Fault Prediction</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table Of Content</h2>
   
  <ul>
  <li><a href="#table-of-content" id="toc-table-of-content" class="nav-link active" data-scroll-target="#table-of-content">Table Of Content</a>
  <ul class="collapse">
  <li><a href="#test-set" id="toc-test-set" class="nav-link" data-scroll-target="#test-set">Test Set</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">



<section id="table-of-content" class="level2">
<h2 class="anchored" data-anchor-id="table-of-content">Table Of Content</h2>
<ol type="1">
<li><a href="#libraries">Libraries</a></li>
<li><a href="#data">Data</a></li>
<li><a href="#dictionary">Data Dictionary</a></li>
<li><a href="#inspection">Data Inspection</a></li>
<li><a href="#clean">Data Cleaning</a></li>
<li><a href="#eda">Explortatory Data Analysis</a></li>
<li><a href="#model">Modelling</a></li>
<li><a href="#testing">Testing</a></li>
</ol>
<p><a name="libraries"></a><a> ## Libraries</a></p><a>
</a><div class="cell" data-execution_count="3"><a>
</a><div class="sourceCode cell-code" id="cb1"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb1-1"></span></code></a><code class="sourceCode python"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotnine <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold, cross_validate, cross_val_score, cross_val_predict  <span class="co"># train_test_split,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils <span class="im">import</span> resample</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> KNNImputer</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score, confusion_matrix, classification_report, ConfusionMatrixDisplay, precision_score, recall_score</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom Functions</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> function <span class="im">as</span> cfun</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a name="data"></a><a> ## Data</a></p><a>
</a><div class="cell" data-execution_count="6"><a>
</a><div class="sourceCode cell-code" id="cb4"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb4-1"></span></code></a><code class="sourceCode python"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> pd.read_csv(<span class="st">'data/train.csv'</span>, parse_dates <span class="op">=</span> [<span class="st">'Datetime'</span>])
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> pd.read_csv(<span class="st">'data/test.csv'</span>, parse_dates <span class="op">=</span> [<span class="st">'Datetime'</span>])</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>samplesubmission <span class="op">=</span> pd.read_csv(<span class="st">'data/SampleSubmission.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a name="dictionary"></a><a> ### Data Dictionary</a></p><a>
<p><strong>Sensor1_PM2.5, Sensor2_PM2.5 ::</strong> These are recorded PM2.5 from Sensor 1 and Sensor 2.<br>
<strong>NOTE :</strong> <em>PM2.5 also called Fine particulate matter are tiny particles in the air that reduce visibility and cause the air to appear hazy when levels are elevated. (PM2.5 are complex because they can be made up of numerous types of chemicals and particles and they can also be partly liquid. measured in micrograms per cubic meter. “a microgram is a unit of weight, there are a million micrograms in a gram, &amp; a pound = 450 grams.”</em></p>
<p><strong>Temparature ::</strong> This is the degree or indensity of heat present when each PM2.5 was recorded using a Celsius scale. Note that higher tempemperature leads to low air quality. Also When the weather is hot primary sources of pollutants tend to increase.</p>
<p><strong>Relative_Humidity ::</strong> Relative humidity is the amount of water vapor in the air, expressed as a percentage of the maximum amount of water vapor the air can hold at the same temperature. A high humidity increases the rate of harmful or toxic chemicals in the air.</p>
</a><p><a></a><a name="inspection"></a><a> ### Data Inspection 1. </a><a href="#info">Data Info</a> 2. <a href="#missing">Missing Values</a> 3. <a href="#duplicate">Duplicates</a> 4. <a href="#outlier">Outliers</a></p>
<p><a name="info"></a><a> #### Data Info</a></p><a>
</a><div class="cell" data-execution_count="9"><a>
</a><div class="sourceCode cell-code" id="cb5"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb5-1"></span></code></a><code class="sourceCode python"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>train.info()</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 297177 entries, 0 to 297176
Data columns (total 7 columns):
 #   Column             Non-Null Count   Dtype         
---  ------             --------------   -----         
 0   ID                 297177 non-null  object        
 1   Datetime           297177 non-null  datetime64[ns]
 2   Sensor1_PM2.5      293563 non-null  float64       
 3   Sensor2_PM2.5      293563 non-null  float64       
 4   Temperature        293628 non-null  float64       
 5   Relative_Humidity  293628 non-null  float64       
 6   Offset_fault       297177 non-null  int64         
dtypes: datetime64[ns](1), float64(4), int64(1), object(1)
memory usage: 15.9+ MB</code></pre>
</div>
</div>
<p>There are 297,177 records and 7 variables of airquality data in the training data set, also the non null count shows that tamperature, relative humidity and both sensors have missing values in them.</p>
<p><a name="missing"></a><a> #### Missing Values</a></p><a>
</a><div class="cell" data-execution_count="11"><a>
</a><div class="sourceCode cell-code" id="cb7"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb7-1"></span></code></a><code class="sourceCode python"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>na_df <span class="op">=</span> train.isnull().<span class="bu">sum</span>().to_frame().rename(columns <span class="op">=</span> {<span class="dv">0</span>: <span class="st">"Number of Missing Value"</span>})
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>na_df[<span class="st">"percentage"</span>] <span class="op">=</span> <span class="bu">round</span>((na_df[<span class="st">"Number of Missing Value"</span>] <span class="op">/</span> train.shape[<span class="dv">0</span>])<span class="op">*</span><span class="dv">100</span>, <span class="dv">3</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>na_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Number of Missing Value</th>
      <th>percentage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ID</th>
      <td>0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>Datetime</th>
      <td>0</td>
      <td>0.000</td>
    </tr>
    <tr>
      <th>Sensor1_PM2.5</th>
      <td>3614</td>
      <td>1.216</td>
    </tr>
    <tr>
      <th>Sensor2_PM2.5</th>
      <td>3614</td>
      <td>1.216</td>
    </tr>
    <tr>
      <th>Temperature</th>
      <td>3549</td>
      <td>1.194</td>
    </tr>
    <tr>
      <th>Relative_Humidity</th>
      <td>3549</td>
      <td>1.194</td>
    </tr>
    <tr>
      <th>Offset_fault</th>
      <td>0</td>
      <td>0.000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Both PM2.5 sensors have 3,614 missing values which is 1.2% of the train data set, while both tempaerature and relative humidity have 3,549 (1.2%) of missing data.</p>
<section id="question" class="level5">
<h5 class="anchored" data-anchor-id="question">Question:</h5>
<p>There are similar missing number of values for both sensors and also temperature and relative humidity, so are these missing records similar in the data.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> related_missing_record(df, cols):</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    check_1 <span class="op">=</span> df.loc[df[cols[<span class="dv">0</span>]].isna()].loc[df[cols[<span class="dv">1</span>]].notna()].shape[<span class="dv">0</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    check_2 <span class="op">=</span> df.loc[df[cols[<span class="dv">1</span>]].isna()].loc[df[cols[<span class="dv">0</span>]].notna()].shape[<span class="dv">0</span>]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> check_1 <span class="op">==</span> check_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Both Sensor ::</span><span class="ch">\n</span><span class="sc">{</span>related_missing_record(train, [<span class="st">'Sensor1_PM2.5'</span>, <span class="st">'Sensor2_PM2.5'</span>])<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Train Temperature &amp; Relative Humidity::</span><span class="ch">\n</span><span class="sc">{</span>related_missing_record(train, [<span class="st">'Temperature'</span>, <span class="st">'Relative_Humidity'</span>])<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Both Sensor ::
True

Train Temperature &amp; Relative Humidity::
True
</code></pre>
</div>
</div>
<p>Looks like there were faliure/reason for skipping data entry during a specific period of time for both sensors. let get the minimum and maximum date for this missing record.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Sensor1_PM2.5"</span>, <span class="st">"Temperature"</span>]:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> ::</span><span class="ch">\n</span><span class="sc">{</span>train<span class="sc">.</span>loc[train[col].isna()][<span class="st">'Datetime'</span>]<span class="sc">.</span>agg([<span class="st">'min'</span>, <span class="st">'max'</span>])<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensor1_PM2.5 ::
min   2021-10-18 10:00:13
max   2021-10-22 14:58:43
Name: Datetime, dtype: datetime64[ns]

Temperature ::
min   2021-10-30 11:00:31
max   2022-01-19 14:59:34
Name: Datetime, dtype: datetime64[ns]
</code></pre>
</div>
</div>
<p><a name="duplicate"></a><a> #### Duplicates</a></p><a>
</a><div class="cell" data-execution_count="15"><a>
</a><div class="sourceCode cell-code" id="cb13"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb13-1"></span></code></a><code class="sourceCode python"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>train.duplicated().<span class="bu">sum</span>()</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>0</code></pre>
</div>
</div>
<p><a name="outlier"></a><a> #### Outliers</a></p><a>
</a><div class="cell" data-execution_count="24"><a>
</a><div class="sourceCode cell-code" id="cb15"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb15-1"></span></code></a><code class="sourceCode python"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows <span class="op">=</span> <span class="dv">2</span>, ncols <span class="op">=</span> <span class="dv">2</span>, figsize <span class="op">=</span> (<span class="dv">19</span>, <span class="dv">7</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>fig.suptitle(<span class="st">'Variable Distribution'</span>, y <span class="op">=</span> <span class="fl">0.93</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, data, name <span class="kw">in</span> <span class="bu">zip</span>(axes.flatten(), train, [<span class="st">'Sensor1_PM2.5'</span>, <span class="st">'Sensor2_PM2.5'</span>, <span class="st">'Temperature'</span>, <span class="st">'Relative_Humidity'</span>]):</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    sns.boxplot(train[name], ax <span class="op">=</span> ax)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(name)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>outlier_cols <span class="op">=</span> [<span class="st">"Sensor1_PM2.5"</span>, <span class="st">"Sensor2_PM2.5"</span>, <span class="st">"Relative_Humidity"</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> outlier_cols:</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Outlier :: </span><span class="sc">{</span>cfun<span class="sc">.</span>get_outlier(train, col, <span class="fl">1.5</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensor1_PM2.5 Outlier :: [-18.055, 89.905]
--------------------
Sensor2_PM2.5 Outlier :: [-22.555000000000003, 89.64500000000001]
--------------------
Relative_Humidity Outlier :: [33.5, 125.5]
--------------------</code></pre>
</div>
</div>
<p>Both Sensors have some extrem large values that shows that there where some times when the sensors picked up dengerous level of Fine particulate matter around the area.</p>
</section>
<section id="question-1" class="level5">
<h5 class="anchored" data-anchor-id="question-1">Question:</h5>
<p>Are these extreme values somehow related to the periods when the pm2.5 sensors where condsidered faulty.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Sensor1_PM2.5"</span>, <span class="st">"Sensor2_PM2.5"</span>]:</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Outlier :: </span><span class="sc">{</span>cfun<span class="sc">.</span>get_outlier(train.query(<span class="st">'Offset_fault == 0'</span>), col, <span class="fl">1.5</span>, typ<span class="op">=</span><span class="st">'upper'</span>)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Max </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> value :: </span><span class="sc">{</span>train<span class="sc">.</span>query(<span class="st">'Offset_fault == 0'</span>)[col]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensor1_PM2.5 Outlier :: 92.72

Max Sensor1_PM2.5 value :: 997.96


Sensor2_PM2.5 Outlier :: 92.025

Max Sensor2_PM2.5 value :: 997.26

</code></pre>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"Sensor1_PM2.5"</span>, <span class="st">"Sensor2_PM2.5"</span>]:</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Outlier :: </span><span class="sc">{</span>cfun<span class="sc">.</span>get_outlier(train.query(<span class="st">'Offset_fault == 1'</span>), col, <span class="fl">1.5</span>, typ<span class="op">=</span><span class="st">'upper'</span>)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Max </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> value :: </span><span class="sc">{</span>train<span class="sc">.</span>query(<span class="st">'Offset_fault == 1'</span>)[col]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ch">\n\n</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensor1_PM2.5 Outlier :: 81.525

Max Sensor1_PM2.5 value :: 283.18


Sensor2_PM2.5 Outlier :: 71.0

Max Sensor2_PM2.5 value :: 248.4

</code></pre>
</div>
</div>
<p>Both occations show that the extreme values are present inspite of whether the sensor is considered faulty or not.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> outlier_cols:</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of Outlier in </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>cfun<span class="sc">.</span>filter_outlier(train, col, <span class="st">'inner'</span>)<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"-"</span><span class="op">*</span><span class="dv">46</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of Outlier in Sensor1_PM2.5 is 17,402
----------------------------------------------
Number of Outlier in Sensor2_PM2.5 is 15,463
----------------------------------------------
Number of Outlier in Relative_Humidity is 772
----------------------------------------------</code></pre>
</div>
</div>
<p><a name="clean"></a><a> ### Data Cleaning The train data will be restructured for exploration.</a></p><a>
</a><div class="cell" data-execution_count="18"><a>
</a><div class="sourceCode cell-code" id="cb24"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb24-1"></span></code></a><code class="sourceCode python"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dropping missing values</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>e_train <span class="op">=</span> train.dropna().copy()</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>e_train.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>(290014, 7)</code></pre>
</div>
</div>
<p><a name="eda"></a><a> ## Exploratory Data Analysis 1. </a><a href="#add_var">Additional Variables</a> 1. <a href="#uni">Univariate Analysis</a> 2. <a href="#multi">Multivarite Analysis</a> 3. <a href="#corr">Correlation</a></p>
<p><a name="add_var"></a><a> ### Additional Variables</a></p><a>
<p>The sensors PM2.5 records are numeric, a categorical variable will be created to distinguish this records for better data exploration.</p>
</a><div class="cell" data-execution_count="19"><a>
</a><div class="sourceCode cell-code" id="cb26"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb26-1"></span></code></a><code class="sourceCode python"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>e_train <span class="op">=</span> cfun.add_pmCategory(e_train, ordinal<span class="op">=</span><span class="va">False</span>)
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"S1_AQI"</span>, <span class="st">"S2_AQI"</span>]:</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    e_train[col] <span class="op">=</span> e_train[col].astype(<span class="st">"category"</span>) </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    e_train[col] <span class="op">=</span> e_train[col].cat.reorder_categories([<span class="st">"Good"</span>, <span class="st">"Moderate"</span>, <span class="st">"Unhealthy (SG)"</span>, <span class="st">"Unhealthy"</span>, <span class="st">"Very Unhealthy"</span>, <span class="st">"Hazardous"</span>], ordered <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Defining Air Quality Index Categories 1. <strong>Good</strong> :: Little to no risk (PM2.5 from 0 - 12.0)<br>
2. <strong>Moderate</strong> :: Unusually sensitive individuals may experience respiratory symptoms. (PM2.5 from 21.1 - 35.4)<br>
3. <strong>Unhealthy</strong> (for sensitive groups) :: Increasing likelihood of respiratory symptoms in sensitive individuals. (PM2.5 from 35.5 - 55.4) 4. <strong>Unhealthy</strong> :: Increased respiratory effect in general population. (PM2.5 from 55.5 - 150.4) 5. <strong>Very Unhealthy</strong> :: Significant increase in respiratory effect in general population. (PM2.5 from 150.4 - 250.4) 6. <strong>Hazardous</strong> :: Serious risk of respiratory effect in general population (PM2.5 from 250.4 - 500.4)<br>
source: <a href="https//www.epa.gov">U.S.Environmental Protection Agency</a></p>
<p>The Datetime contains the timestamp of the data collection, from this variable the individual hour, month, and year will be extracted.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>e_train <span class="op">=</span> cfun.get_standAlone_dates(e_train, <span class="st">"Datetime"</span>, [<span class="st">"hour"</span>, <span class="st">"month"</span>, <span class="st">"year"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Changing offset fault for better readability during exploration</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>e_train[<span class="st">"faulty"</span>] <span class="op">=</span> e_train[<span class="st">"Offset_fault"</span>].replace({<span class="dv">0</span>: <span class="st">"No"</span>, <span class="dv">1</span>: <span class="st">"Yes"</span>})</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>e_train.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>ID</th>
      <th>Datetime</th>
      <th>Sensor1_PM2.5</th>
      <th>Sensor2_PM2.5</th>
      <th>Temperature</th>
      <th>Relative_Humidity</th>
      <th>Offset_fault</th>
      <th>S1_AQI</th>
      <th>S2_AQI</th>
      <th>Hour</th>
      <th>Month</th>
      <th>Year</th>
      <th>faulty</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ID_QF0ZTQJ2SF5Q</td>
      <td>2021-11-03 04:06:31</td>
      <td>52.58</td>
      <td>49.52</td>
      <td>17.4</td>
      <td>96.0</td>
      <td>0</td>
      <td>Unhealthy (SG)</td>
      <td>Unhealthy (SG)</td>
      <td>4</td>
      <td>11</td>
      <td>2021</td>
      <td>No</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ID_4GTK689CNX5S</td>
      <td>2021-11-08 18:43:23</td>
      <td>35.25</td>
      <td>33.40</td>
      <td>25.0</td>
      <td>75.0</td>
      <td>0</td>
      <td>Moderate</td>
      <td>Moderate</td>
      <td>18</td>
      <td>11</td>
      <td>2021</td>
      <td>No</td>
    </tr>
    <tr>
      <th>2</th>
      <td>ID_DL7VVKW9U7XQ</td>
      <td>2021-11-07 09:50:33</td>
      <td>19.18</td>
      <td>23.50</td>
      <td>24.9</td>
      <td>75.0</td>
      <td>0</td>
      <td>Moderate</td>
      <td>Moderate</td>
      <td>9</td>
      <td>11</td>
      <td>2021</td>
      <td>No</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ID_6XQOMBXM2DG3</td>
      <td>2022-01-01 18:55:15</td>
      <td>19.40</td>
      <td>15.48</td>
      <td>24.9</td>
      <td>70.0</td>
      <td>0</td>
      <td>Moderate</td>
      <td>Moderate</td>
      <td>18</td>
      <td>1</td>
      <td>2022</td>
      <td>No</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ID_UQZW9ISJY9QE</td>
      <td>2021-11-05 22:23:48</td>
      <td>38.30</td>
      <td>34.77</td>
      <td>20.9</td>
      <td>89.0</td>
      <td>0</td>
      <td>Unhealthy (SG)</td>
      <td>Moderate</td>
      <td>22</td>
      <td>11</td>
      <td>2021</td>
      <td>No</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><a name="uni"></a><a> ### Univariate Analysis</a></p><a>
</a><div class="cell" data-execution_count="25"><a>
</a><div class="sourceCode cell-code" id="cb29"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb29-1"></span></code></a><code class="sourceCode python"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>cfun.rec_count(e_train, <span class="st">"faulty"</span>, title <span class="op">=</span> <span class="st">"Device Status"</span>, typ <span class="op">=</span> <span class="st">"plt"</span>)</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="25">
<pre><code>&lt;ggplot: (80869490214)&gt;</code></pre>
</div>
</div>
<p>The outcome variable <code>offset fault</code> contains only two categories which are 1/Yes for PM2.5 sensors that were considered sending faulty signals at the time and 0/No for sensors working well. From the bar chart above, there are less faulty sensors (36.95%) that faulty sensors (63.05%) overall.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>e_train.select_dtypes(<span class="st">"number"</span>).describe().applymap(<span class="kw">lambda</span> x: <span class="bu">round</span>(x, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Sensor1_PM2.5</th>
      <th>Sensor2_PM2.5</th>
      <th>Temperature</th>
      <th>Relative_Humidity</th>
      <th>Offset_fault</th>
      <th>Hour</th>
      <th>Month</th>
      <th>Year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>290014.000</td>
      <td>290014.000</td>
      <td>290014.000</td>
      <td>290014.000</td>
      <td>290014.000</td>
      <td>290014.000</td>
      <td>290014.000</td>
      <td>290014.000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>40.902</td>
      <td>38.319</td>
      <td>23.323</td>
      <td>78.614</td>
      <td>0.369</td>
      <td>11.350</td>
      <td>9.082</td>
      <td>2021.208</td>
    </tr>
    <tr>
      <th>std</th>
      <td>28.598</td>
      <td>28.723</td>
      <td>3.842</td>
      <td>14.792</td>
      <td>0.483</td>
      <td>6.969</td>
      <td>4.195</td>
      <td>0.406</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-9.450</td>
      <td>-9.700</td>
      <td>16.700</td>
      <td>27.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>1.000</td>
      <td>2021.000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>22.570</td>
      <td>19.620</td>
      <td>20.400</td>
      <td>68.000</td>
      <td>0.000</td>
      <td>5.000</td>
      <td>10.000</td>
      <td>2021.000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>36.650</td>
      <td>33.850</td>
      <td>21.900</td>
      <td>84.000</td>
      <td>0.000</td>
      <td>11.000</td>
      <td>11.000</td>
      <td>2021.000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>49.550</td>
      <td>47.700</td>
      <td>26.300</td>
      <td>91.000</td>
      <td>1.000</td>
      <td>17.000</td>
      <td>12.000</td>
      <td>2021.000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>997.960</td>
      <td>997.260</td>
      <td>34.900</td>
      <td>99.000</td>
      <td>1.000</td>
      <td>23.000</td>
      <td>12.000</td>
      <td>2022.000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>In micrograms per cubic meter the minimum value for sensors 1 and 2 falls within the range -9.45 to -9.70 respectively while that maximum value falls within the range 997.96 to 997.26 respectively which shows only a very small difference, for the average value given that there are huge presence of outliers in both sensors it will be more accurate to look at the median value where 50% for sensor 1 fall between 36.65 and lower also for sensor 2 33.85 and lower.</p>
<p>There was an average temperature of 23.32 degrees overall for the train set and for relative humidity 78.61.</p>
</section>
<section id="sensor-1-and-2-distribution" class="level4">
<h4 class="anchored" data-anchor-id="sensor-1-and-2-distribution">Sensor 1 and 2 Distribution</h4>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col, sensor <span class="kw">in</span> <span class="bu">zip</span>([<span class="st">"Sensor1_PM2.5"</span>, <span class="st">"Sensor2_PM2.5"</span>], [<span class="dv">1</span>, <span class="dv">2</span>]):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cfun.histPlot(e_train, col, bins <span class="op">=</span> <span class="dv">100</span>, title<span class="op">=</span><span class="ss">f"Sensor </span><span class="sc">{</span>sensor<span class="sc">}</span><span class="ss"> PM2.5"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-23-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
</section>
<section id="air-quality-index" class="level4">
<h4 class="anchored" data-anchor-id="air-quality-index">Air Quality Index</h4>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"S1_AQI"</span>, <span class="st">"S2_AQI"</span>]:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cfun.air_quality_count(e_train, col))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-24-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-24-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<p>Sensor 2 Picked up more Good PM2.5 signals (11.87%) than sensor 1 (8.51%), both sensors have just 0.03% of it recodes as hazadious while the highest Air quality index category recorded was moderate level with 39% and 41% respectively for sensor 1 and 2.</p>
</section>
<section id="temperature" class="level4">
<h4 class="anchored" data-anchor-id="temperature">Temperature</h4>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cfun.boxPlot(e_train, <span class="st">"Temperature"</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cfun.histPlot(e_train, <span class="st">"Temperature"</span>, bins<span class="op">=</span><span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-25-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>&lt;ggplot: (80869548762)&gt;</code></pre>
</div>
</div>
<p>Given that the distibution is skewed, it shows that there are more low temperatures recorded then high temperatures.</p>
</section>
<section id="relative-humidity" class="level4">
<h4 class="anchored" data-anchor-id="relative-humidity">Relative Humidity</h4>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(cfun.boxPlot(e_train, <span class="st">"Relative_Humidity"</span>, axis_text_suffix<span class="op">=</span><span class="st">"%"</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>cfun.histPlot(e_train, <span class="st">"Relative_Humidity"</span>, bins<span class="op">=</span><span class="dv">35</span>, axis_text_suffix<span class="op">=</span><span class="st">"%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-26-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>&lt;ggplot: (80873476733)&gt;</code></pre>
</div>
</div>
<p>More high relative humidity was recorded than low relative humidity Over the selected period.</p>
</section>
<section id="datetime" class="level4">
<h4 class="anchored" data-anchor-id="datetime">DateTime</h4>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>e_train[<span class="st">"Datetime"</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>count                  290014
unique                 286694
top       2021-11-05 12:40:33
freq                        3
first     2021-10-15 16:00:31
last      2022-01-21 07:34:57
Name: Datetime, dtype: object</code></pre>
</div>
</div>
<p>For the train data set the we can see that the records started from the 15th of October 2021 up to the 21st of january 2022.</p>
<section id="month" class="level5">
<h5 class="anchored" data-anchor-id="month">Month</h5>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>e_train[<span class="st">"Month"</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>array([11,  1, 12, 10], dtype=int64)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>cfun.rec_count(e_train, <span class="st">"Month"</span>, rename_axis_text <span class="op">=</span> [<span class="st">"January"</span>, <span class="st">"October"</span>, <span class="st">"November"</span>, <span class="st">"December"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-29-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>&lt;ggplot: (80873454565)&gt;</code></pre>
</div>
</div>
</section>
<section id="year" class="level5">
<h5 class="anchored" data-anchor-id="year">Year</h5>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>cfun.rec_count(e_train, <span class="st">"Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<pre><code>&lt;ggplot: (80878660783)&gt;</code></pre>
</div>
</div>
<p><a name="multi"></a><a> ### Multivarite Analysis 1. </a><a href="#dspm">Device Status and Particulate Matter</a> 2. <a href="#trhds">Temperature, Relative_Humidity and Device status</a> 3. <a href="#aqithr">Air Quality with Temperature &amp; Relative Humidity</a></p>
<p><a name="dspm"></a><a> #### Device Status and Particulate Matter</a></p><a>
</a><div class="cell" data-execution_count="22"><a>
</a><div class="sourceCode cell-code" id="cb52"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb52-1"></span></code></a><code class="sourceCode python"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>f_color <span class="op">=</span> [<span class="st">"#75F4F4"</span>, <span class="st">"#D17B83"</span>]
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> [<span class="st">"Sensor1_PM2.5"</span>, <span class="st">"Sensor2_PM2.5"</span>]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>s_type <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">2</span>]</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sensor, typ <span class="kw">in</span> <span class="bu">zip</span>(cols, s_type):</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cfun.boxPlot(e_train, </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                       num_var <span class="op">=</span> sensor, </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>                       cat_var <span class="op">=</span> <span class="st">"faulty"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>                       color <span class="op">=</span> f_color,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                        zoom = (0, 100),</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>                       title <span class="op">=</span> [<span class="ss">f"particulate matter 2.5 From Sensor </span><span class="sc">{</span>typ<span class="sc">}</span><span class="ss">"</span>, <span class="st">"Device Status"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-31-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<p>For both sensors there where more extreme PM2.5 values recorded when no faulty signals was detected than when it was.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>sen_agg <span class="op">=</span> cfun.vars_longer_summary(e_train, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                                   select_vars <span class="op">=</span> [<span class="st">"faulty"</span>, <span class="st">"Sensor1_PM2.5"</span>, <span class="st">"Sensor2_PM2.5"</span>], </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                                   var_name <span class="op">=</span> <span class="st">"Sensor"</span>, value_name <span class="op">=</span> <span class="st">"PM 2.5"</span>, </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                                   replace_rec <span class="op">=</span> [<span class="st">"Sensor 1"</span>, <span class="st">"Sensor 2"</span>])</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>sen_agg.drop(<span class="st">"sum"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>faulty</th>
      <th>Sensor</th>
      <th>min</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>No</td>
      <td>Sensor 1</td>
      <td>0.00</td>
      <td>44.757375</td>
      <td>39.58</td>
      <td>997.96</td>
    </tr>
    <tr>
      <th>1</th>
      <td>No</td>
      <td>Sensor 2</td>
      <td>0.18</td>
      <td>45.115641</td>
      <td>39.73</td>
      <td>997.26</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Yes</td>
      <td>Sensor 1</td>
      <td>-9.45</td>
      <td>34.322565</td>
      <td>31.98</td>
      <td>283.18</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Yes</td>
      <td>Sensor 2</td>
      <td>-9.70</td>
      <td>26.719856</td>
      <td>24.42</td>
      <td>248.40</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>summary_fun <span class="op">=</span> [<span class="st">"median"</span>, <span class="st">"max"</span>]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>plt_title <span class="op">=</span> [<span class="st">"Median"</span>, <span class="st">"Maximum"</span>]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sumy_fun, plt_tl <span class="kw">in</span> <span class="bu">zip</span>(summary_fun, plt_title):</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(cfun.facet_summary_plot2(df <span class="op">=</span> sen_agg, cat_var <span class="op">=</span> <span class="st">"faulty"</span>, num_var <span class="op">=</span> sumy_fun, fill <span class="op">=</span> <span class="st">"faulty"</span>, facet_by <span class="op">=</span> <span class="st">"Sensor"</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                                   ylab <span class="op">=</span> <span class="st">"PM2.5"</span>, title <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>plt_tl<span class="sc">}</span><span class="ss"> Particulate Matter By Offset Fault For Each Sensor"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-33-output-3.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<p>The Median PM2.5 for sensor 2 when no signal offset fault was detected (61.93%) is higher than that of sensor 1 (55.31%) and the reverse is the case when a fault was detected. in conclusion sensor 1 had more offset faults than sensor 2.</p>
</section>
<section id="temperature-relative-humidity-and-device-status" class="level5">
<h5 class="anchored" data-anchor-id="temperature-relative-humidity-and-device-status">Temperature, Relative Humidity and Device status</h5>
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>tr_agg <span class="op">=</span> cfun.vars_longer_summary(e_train, </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>                                  select_vars <span class="op">=</span> [<span class="st">"faulty"</span>, <span class="st">"Temperature"</span>, <span class="st">"Relative_Humidity"</span>],</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>                                  var_name  <span class="op">=</span> <span class="st">"variable"</span>, value_name <span class="op">=</span> <span class="st">"value"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>tr_agg.drop(<span class="st">"sum"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>faulty</th>
      <th>variable</th>
      <th>min</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>No</td>
      <td>Relative_Humidity</td>
      <td>27.0</td>
      <td>78.639955</td>
      <td>84.0</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>No</td>
      <td>Temperature</td>
      <td>16.7</td>
      <td>23.314492</td>
      <td>21.9</td>
      <td>34.9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Yes</td>
      <td>Relative_Humidity</td>
      <td>27.0</td>
      <td>78.570774</td>
      <td>84.0</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Yes</td>
      <td>Temperature</td>
      <td>16.7</td>
      <td>23.336810</td>
      <td>22.0</td>
      <td>34.9</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>cfun.facet_summary_plot2(df <span class="op">=</span> tr_agg, cat_var <span class="op">=</span> <span class="st">"faulty"</span>, num_var <span class="op">=</span> <span class="st">"median"</span>, fill <span class="op">=</span> <span class="st">"faulty"</span>, facet_by <span class="op">=</span> <span class="st">"variable"</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>                         sb_aj<span class="op">=</span><span class="fl">0.1</span>, title <span class="op">=</span> <span class="st">"Median Of Temperature &amp; Relative Humidity By Device Status"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-35-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>&lt;ggplot: (80880517760)&gt;</code></pre>
</div>
</div>
<p><a name="aqithr"></a><a> #### Air Quality with Temperature &amp; Relative Humidity</a></p><a>
</a></section><a>
</a><section id="air-quality-from-sensor-1" class="level5"><a>
<h5 class="anchored" data-anchor-id="air-quality-from-sensor-1">Air quality from Sensor 1</h5>
</a><div class="cell" data-execution_count="27"><a>
</a><div class="sourceCode cell-code" id="cb62"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb62-1"></span></code></a><code class="sourceCode python"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>aqi_tr <span class="op">=</span>  cfun.vars_longer_summary(e_train, 
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                                   select_vars<span class="op">=</span>[<span class="st">"S1_AQI"</span>, <span class="st">"Temperature"</span>, <span class="st">"Relative_Humidity"</span>], </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                                   var_name   <span class="op">=</span><span class="st">"Variable"</span>, </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                                   value_name <span class="op">=</span><span class="st">"PM2.5"</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>aqi_tr.drop(<span class="st">"sum"</span>, axis<span class="op">=</span><span class="dv">1</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>S1_AQI</th>
      <th>Variable</th>
      <th>min</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Good</td>
      <td>Relative_Humidity</td>
      <td>27.0</td>
      <td>65.902633</td>
      <td>65.0</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Good</td>
      <td>Temperature</td>
      <td>17.2</td>
      <td>26.907975</td>
      <td>27.6</td>
      <td>34.9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Moderate</td>
      <td>Relative_Humidity</td>
      <td>27.0</td>
      <td>73.571333</td>
      <td>74.0</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Moderate</td>
      <td>Temperature</td>
      <td>17.1</td>
      <td>24.767452</td>
      <td>24.9</td>
      <td>34.9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Unhealthy (SG)</td>
      <td>Relative_Humidity</td>
      <td>34.0</td>
      <td>83.586812</td>
      <td>87.0</td>
      <td>99.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>cfun.facet_summary_plot(aqi_tr, <span class="st">"S1_AQI"</span>, <span class="st">"mean"</span>, <span class="st">"Variable"</span>,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># colors=["#A9DEF9", "#F9DEC9"], # F1AB86</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a> sb_aj<span class="op">=</span><span class="fl">0.06</span>, title<span class="op">=</span><span class="st">"Average Relative Humidity &amp; Temperature For Sensor 1 By Air Quality Index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-37-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>&lt;ggplot: (110011157781)&gt;</code></pre>
</div>
</div>
</section>
<section id="air-quality-from-sensor-2" class="level5">
<h5 class="anchored" data-anchor-id="air-quality-from-sensor-2">Air quality from Sensor 2</h5>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>aqi_tr <span class="op">=</span>  cfun.vars_longer_summary(e_train, </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                                   select_vars<span class="op">=</span>[<span class="st">"S2_AQI"</span>, <span class="st">"Temperature"</span>, <span class="st">"Relative_Humidity"</span>], </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>                                   var_name   <span class="op">=</span><span class="st">"Variable"</span>, </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                                   value_name <span class="op">=</span><span class="st">"PM2.5"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>aqi_tr.drop(<span class="st">"sum"</span>, axis<span class="op">=</span><span class="dv">1</span>).head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>S2_AQI</th>
      <th>Variable</th>
      <th>min</th>
      <th>mean</th>
      <th>median</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Good</td>
      <td>Relative_Humidity</td>
      <td>27.0</td>
      <td>66.620695</td>
      <td>65.0</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Good</td>
      <td>Temperature</td>
      <td>17.2</td>
      <td>26.722606</td>
      <td>27.5</td>
      <td>34.9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Moderate</td>
      <td>Relative_Humidity</td>
      <td>27.0</td>
      <td>75.574615</td>
      <td>78.0</td>
      <td>99.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Moderate</td>
      <td>Temperature</td>
      <td>16.9</td>
      <td>24.209235</td>
      <td>23.5</td>
      <td>34.9</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Unhealthy (SG)</td>
      <td>Relative_Humidity</td>
      <td>34.0</td>
      <td>83.600160</td>
      <td>87.0</td>
      <td>99.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>cfun.facet_summary_plot(aqi_tr, <span class="st">"S2_AQI"</span>, <span class="st">"mean"</span>, <span class="st">"Variable"</span>, sb_aj<span class="op">=</span><span class="fl">0.06</span>, title<span class="op">=</span><span class="st">"Average Relative Humidity &amp; Temperature For Sensor 2 By Air Quality Index"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>&lt;ggplot: (80881608356)&gt;</code></pre>
</div>
</div>
<p>For relative humidity using the above chart the higher the critical level of PM2.5 the higher the relative humidity on an average with the exception of hazardous level. while for temperature the higher the critical level of PM2.5 the lower the degree of temperature on an average with only the exception of hazardous level.</p>
<p><a name="corr"></a><a> ### Correlation</a></p><a>
</a><div class="cell" data-execution_count="35"><a>
</a><div class="sourceCode cell-code" id="cb68"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb68-1"></span></code></a><code class="sourceCode python"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">27</span>, <span class="dv">12</span>))
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>num_cols <span class="op">=</span> [<span class="st">'Sensor1_PM2.5'</span>, <span class="st">'Sensor2_PM2.5'</span>, <span class="st">'Temperature'</span>, <span class="st">'Relative_Humidity'</span>]</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>sns.pairplot(e_train[num_cols], kind <span class="op">=</span> <span class="st">"scatter"</span>, plot_kws <span class="op">=</span> <span class="bu">dict</span>(s<span class="op">=</span><span class="dv">80</span>, edgecolor<span class="op">=</span><span class="st">"white"</span>, linewidth<span class="op">=</span><span class="fl">2.5</span>, color<span class="op">=</span><span class="st">"#02A9EA"</span>))</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 2700x1200 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-40-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordinal Encoding</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>corr_df <span class="op">=</span> e_train.copy()</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">"S1_AQI"</span>, <span class="st">"S2_AQI"</span>]:</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    corr_df[col] <span class="op">=</span> corr_df[col].replace({<span class="st">"Hazardous"</span>     : <span class="dv">0</span>, </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Very Unhealthy"</span>: <span class="dv">1</span>, </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Unhealthy"</span>     : <span class="dv">2</span>, </span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Unhealthy (SG)"</span>: <span class="dv">3</span>, </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Moderate"</span>      : <span class="dv">4</span>, </span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="st">"Good"</span>          : <span class="dv">5</span>})</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    corr_df[col] <span class="op">=</span> corr_df[col].astype(<span class="st">"int64"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>cor <span class="op">=</span> corr_df.select_dtypes([<span class="st">"int64"</span>, <span class="st">"float64"</span>]).corr()</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">13</span>, <span class="dv">8</span>))</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cor, cmap <span class="op">=</span> <span class="st">'RdYlBu'</span>, annot <span class="op">=</span> <span class="va">True</span>, center <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Correlogram'</span>, fontsize <span class="op">=</span> <span class="dv">15</span>, color <span class="op">=</span> <span class="st">'darkgreen'</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-42-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Both sensors 1 &amp; 2 are highly positively correlated with each other.<br>
Air quality index(AQI) from both sensors are negatively correlated with the PM2.5 values.<br>
Temperature have a positive correlation with AQI while Relative Humidity have a negative correlation with AQI.</p>
<p><a name="model"></a><a> ## Modelling</a></p><a>
<p>For the training set all missing values will be removed from the data.<br>
Additional variables such as an ordinal air quality index as integer for both sensors will be added to the training set.<br>
Also the hour and day of the year will be extracted from the datetime variable after which the datetime variable will be dropped with the Id variable as they are both high cardinality features.</p>
</a><div class="cell" data-execution_count="9"><a>
</a><div class="sourceCode cell-code" id="cb72"><a></a><pre class="sourceCode python code-with-copy"><a><code class="sourceCode python"><span id="cb72-1"></span></code></a><code class="sourceCode python"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>ord_train <span class="op">=</span> train.sort_values(by<span class="op">=</span><span class="st">"Datetime"</span>)
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>add_df <span class="op">=</span> cfun.add_attributes(ord_train, drop_nan_value<span class="op">=</span><span class="va">True</span>, fill_nan_value<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>train_c <span class="op">=</span> add_df.drop_missing_value()</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>train_c <span class="op">=</span> add_df.add_air_quality_index()</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>train_c <span class="op">=</span> add_df.add_period_variables(hour<span class="op">=</span><span class="va">True</span>, dayofyear<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>train_c <span class="op">=</span> train_c.drop([<span class="st">"ID"</span>, <span class="st">"Datetime"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>train_c.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 290014 entries, 116880 to 226302
Data columns (total 9 columns):
 #   Column             Non-Null Count   Dtype  
---  ------             --------------   -----  
 0   Sensor1_PM2.5      290014 non-null  float64
 1   Sensor2_PM2.5      290014 non-null  float64
 2   Temperature        290014 non-null  float64
 3   Relative_Humidity  290014 non-null  float64
 4   Offset_fault       290014 non-null  int64  
 5   S1_AQI             290014 non-null  int64  
 6   S2_AQI             290014 non-null  int64  
 7   Hour               290014 non-null  int64  
 8   Day_Of_Year        290014 non-null  int64  
dtypes: float64(4), int64(5)
memory usage: 22.1 MB</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>outcome <span class="op">=</span> <span class="st">"Offset_fault"</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> train_c.drop(outcome, axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> train_c[outcome]</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>feature_names <span class="op">=</span> <span class="bu">list</span>(train_c.drop(outcome, axis <span class="op">=</span> <span class="dv">1</span>).columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>num_features <span class="op">=</span> <span class="bu">list</span>(X.select_dtypes(<span class="st">"number"</span>).columns)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>num_pipeline <span class="op">=</span> Pipeline([</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"std_scaler"</span>, StandardScaler())</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>full_pipeline <span class="op">=</span> ColumnTransformer([</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"num"</span>, num_pipeline, num_features)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> full_pipeline.fit_transform(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transformed X</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>X</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>array([[-1.10957703, -1.01101351,  1.71196075, ...,  1.66087637,
         0.66730492,  0.20484599],
       [-1.08300205, -0.94242651,  1.71196075, ...,  1.66087637,
         0.66730492,  0.20484599],
       [-1.20189013, -1.22443398,  1.71196075, ...,  1.66087637,
         0.66730492,  0.20484599],
       ...,
       [ 0.11881666,  0.48919661, -1.67174045, ..., -0.52823302,
        -0.62421669, -1.84915195],
       [ 0.27721755,  0.2761243 , -1.67174045, ..., -0.52823302,
        -0.62421669, -1.84915195],
       [-0.01650596, -0.22243706, -1.67174045, ...,  0.56632168,
        -0.62421669, -1.84915195]])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cross_validation(model, x<span class="op">=</span>X, y<span class="op">=</span>y, model_name<span class="op">=</span><span class="st">"model"</span>, cv<span class="op">=</span><span class="dv">5</span>):</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> cross_val_predict(model, x, y, cv<span class="op">=</span>cv, n_jobs<span class="op">=-</span><span class="dv">1</span>) </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>model_name<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'='</span><span class="op">*</span><span class="dv">50</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Confusion Matrix ::-</span><span class="ch">\n</span><span class="sc">{</span>confusion_matrix(y, y_pred)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="dv">50</span><span class="op">*</span><span class="st">"-"</span>,<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Accuracy :: </span><span class="sc">{</span>accuracy_score(y, y_pred)<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(classification_report(y, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>log_reg <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>dt_class <span class="op">=</span> DecisionTreeClassifier(random_state<span class="op">=</span><span class="dv">11</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>rf_class <span class="op">=</span> RandomForestClassifier(random_state<span class="op">=</span><span class="dv">11</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>knn_class <span class="op">=</span> KNeighborsClassifier(n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> [log_reg, dt_class, rf_class, knn_class]</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>model_names <span class="op">=</span> [<span class="st">"Logistic Regression"</span>, <span class="st">"Decision Tree"</span>, <span class="st">"Random Forest"</span>, <span class="st">"K-Neighbors"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> mdl, mdl_name <span class="kw">in</span> <span class="bu">zip</span>(model, model_names):</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    cross_validation(mdl, model_name<span class="op">=</span>mdl_name)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression
==================================================
Confusion Matrix ::-
[[171446  11417]
 [ 25463  81688]]
-------------------------------------------------- 

Accuracy :: 0.8728337252684353

              precision    recall  f1-score   support

           0       0.87      0.94      0.90    182863
           1       0.88      0.76      0.82    107151

    accuracy                           0.87    290014
   macro avg       0.87      0.85      0.86    290014
weighted avg       0.87      0.87      0.87    290014




Decision Tree
==================================================
Confusion Matrix ::-
[[162400  20463]
 [ 19569  87582]]
-------------------------------------------------- 

Accuracy :: 0.8619652844345446

              precision    recall  f1-score   support

           0       0.89      0.89      0.89    182863
           1       0.81      0.82      0.81    107151

    accuracy                           0.86    290014
   macro avg       0.85      0.85      0.85    290014
weighted avg       0.86      0.86      0.86    290014




Random Forest
==================================================
Confusion Matrix ::-
[[165178  17685]
 [ 15173  91978]]
-------------------------------------------------- 

Accuracy :: 0.8867020212817313

              precision    recall  f1-score   support

           0       0.92      0.90      0.91    182863
           1       0.84      0.86      0.85    107151

    accuracy                           0.89    290014
   macro avg       0.88      0.88      0.88    290014
weighted avg       0.89      0.89      0.89    290014




K-Neighbors
==================================================
Confusion Matrix ::-
[[158818  24045]
 [ 39627  67524]]
-------------------------------------------------- 

Accuracy :: 0.7804519781803637

              precision    recall  f1-score   support

           0       0.80      0.87      0.83    182863
           1       0.74      0.63      0.68    107151

    accuracy                           0.78    290014
   macro avg       0.77      0.75      0.76    290014
weighted avg       0.78      0.78      0.78    290014



</code></pre>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> eval_gs(gs, output<span class="op">=</span><span class="st">"best_estimator"</span>):</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> output <span class="op">==</span> <span class="st">"best_estimator"</span>:</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gs.best_estimator_</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> output <span class="op">==</span> <span class="st">"best_param"</span>:</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gs.best_params_</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> output <span class="op">==</span> <span class="st">"scores_table"</span>:</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>        cv_res <span class="op">=</span> gs.cv_results_</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>        f_df <span class="op">=</span> pd.DataFrame(cv_res[<span class="st">"params"</span>])</span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>        f_df[<span class="st">"mean_test_score"</span>] <span class="op">=</span> cv_res[<span class="st">"mean_test_score"</span>]</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>        f_df[<span class="st">"rank_test_score"</span>] <span class="op">=</span> cv_res[<span class="st">"rank_test_score"</span>]</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>        f_df[<span class="st">"mean_train_score"</span>] <span class="op">=</span> cv_res[<span class="st">"mean_train_score"</span>]</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> f_df.sort_values(by<span class="op">=</span><span class="st">"rank_test_score"</span>, ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> output <span class="op">==</span> <span class="st">"feature_importance"</span>:</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>        feature_importances <span class="op">=</span> gs.best_estimator_.feature_importances_</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>        feat_imp <span class="op">=</span> pd.DataFrame(<span class="bu">sorted</span>(<span class="bu">zip</span>(feature_names, feature_importances), reverse<span class="op">=</span><span class="va">True</span>), columns <span class="op">=</span> [<span class="st">"importance_score"</span>, <span class="st">"Feature"</span>])</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> feat_imp.sort_values(by <span class="op">=</span> <span class="st">"Feature"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"`output` variable was given a wrong value."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">"n_estimators"</span>: [<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">300</span>], <span class="st">"max_leaf_nodes"</span>: [<span class="dv">10</span>, <span class="dv">16</span>], <span class="st">'max_features'</span>:[<span class="dv">3</span>, <span class="dv">4</span>]}</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(rf_class, param_grid, cv<span class="op">=</span><span class="dv">4</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>, return_train_score<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GridSearchCV(cv=4, estimator=RandomForestClassifier(n_jobs=-1, random_state=11),
             n_jobs=-1,
             param_grid={'max_features': [3, 4], 'max_leaf_nodes': [10, 16],
                         'n_estimators': [100, 200, 300]},
             return_train_score=True)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox"><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">GridSearchCV</label><div class="sk-toggleable__content"><pre>GridSearchCV(cv=4, estimator=RandomForestClassifier(n_jobs=-1, random_state=11),
             n_jobs=-1,
             param_grid={'max_features': [3, 4], 'max_leaf_nodes': [10, 16],
                         'n_estimators': [100, 200, 300]},
             return_train_score=True)</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox"><label for="sk-estimator-id-2" class="sk-toggleable__label sk-toggleable__label-arrow">estimator: RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(n_jobs=-1, random_state=11)</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox"><label for="sk-estimator-id-3" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(n_jobs=-1, random_state=11)</pre></div></div></div></div></div></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>eval_gs(grid_search)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<style>#sk-container-id-2 {color: black;background-color: white;}#sk-container-id-2 pre{padding: 0;}#sk-container-id-2 div.sk-toggleable {background-color: white;}#sk-container-id-2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-2 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-2 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-2 div.sk-item {position: relative;z-index: 1;}#sk-container-id-2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-2 div.sk-item::before, #sk-container-id-2 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-2 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-2 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-2 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-2 div.sk-label-container {text-align: center;}#sk-container-id-2 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-2 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(max_features=4, max_leaf_nodes=16, n_jobs=-1,
                       random_state=11)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label sk-toggleable__label-arrow">RandomForestClassifier</label><div class="sk-toggleable__content"><pre>RandomForestClassifier(max_features=4, max_leaf_nodes=16, n_jobs=-1,
                       random_state=11)</pre></div></div></div></div></div>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>eval_gs(grid_search, <span class="st">"best_param"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>{'max_features': 4, 'max_leaf_nodes': 16, 'n_estimators': 100}</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>eval_gs(grid_search, <span class="st">"scores_table"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>max_features</th>
      <th>max_leaf_nodes</th>
      <th>n_estimators</th>
      <th>mean_test_score</th>
      <th>rank_test_score</th>
      <th>mean_train_score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9</th>
      <td>4</td>
      <td>16</td>
      <td>100</td>
      <td>0.835939</td>
      <td>1</td>
      <td>0.846201</td>
    </tr>
    <tr>
      <th>10</th>
      <td>4</td>
      <td>16</td>
      <td>200</td>
      <td>0.834090</td>
      <td>2</td>
      <td>0.845402</td>
    </tr>
    <tr>
      <th>11</th>
      <td>4</td>
      <td>16</td>
      <td>300</td>
      <td>0.831949</td>
      <td>3</td>
      <td>0.843678</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>16</td>
      <td>100</td>
      <td>0.809878</td>
      <td>4</td>
      <td>0.818747</td>
    </tr>
    <tr>
      <th>4</th>
      <td>3</td>
      <td>16</td>
      <td>200</td>
      <td>0.807188</td>
      <td>5</td>
      <td>0.817267</td>
    </tr>
    <tr>
      <th>5</th>
      <td>3</td>
      <td>16</td>
      <td>300</td>
      <td>0.807185</td>
      <td>6</td>
      <td>0.816305</td>
    </tr>
    <tr>
      <th>6</th>
      <td>4</td>
      <td>10</td>
      <td>100</td>
      <td>0.805216</td>
      <td>7</td>
      <td>0.812193</td>
    </tr>
    <tr>
      <th>7</th>
      <td>4</td>
      <td>10</td>
      <td>200</td>
      <td>0.797896</td>
      <td>8</td>
      <td>0.805109</td>
    </tr>
    <tr>
      <th>8</th>
      <td>4</td>
      <td>10</td>
      <td>300</td>
      <td>0.797492</td>
      <td>9</td>
      <td>0.805243</td>
    </tr>
    <tr>
      <th>0</th>
      <td>3</td>
      <td>10</td>
      <td>100</td>
      <td>0.781183</td>
      <td>10</td>
      <td>0.787738</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>10</td>
      <td>300</td>
      <td>0.777797</td>
      <td>11</td>
      <td>0.783745</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3</td>
      <td>10</td>
      <td>200</td>
      <td>0.777648</td>
      <td>12</td>
      <td>0.784164</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="62">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>ft_imp <span class="op">=</span> eval_gs(grid_search, <span class="st">"feature_importance"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>ft_imp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="62">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>importance_score</th>
      <th>Feature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Sensor2_PM2.5</td>
      <td>0.512644</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Sensor1_PM2.5</td>
      <td>0.250991</td>
    </tr>
    <tr>
      <th>3</th>
      <td>S2_AQI</td>
      <td>0.138374</td>
    </tr>
    <tr>
      <th>4</th>
      <td>S1_AQI</td>
      <td>0.049779</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Temperature</td>
      <td>0.028415</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Relative_Humidity</td>
      <td>0.013785</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Day_Of_Year</td>
      <td>0.005353</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Hour</td>
      <td>0.000660</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="63">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    ggplot(ft_imp, aes(x<span class="op">=</span><span class="st">"reorder(importance_score, Feature)"</span>, y<span class="op">=</span><span class="st">"Feature"</span>)) <span class="op">+</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    geom_col() <span class="op">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>    coord_flip() <span class="op">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    labs(x<span class="op">=</span><span class="st">""</span>, y<span class="op">=</span><span class="st">""</span>, title<span class="op">=</span><span class="st">"Feature Importance"</span>) <span class="op">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>    theme_light() <span class="op">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>    theme(plot_title<span class="op">=</span> element_text(color<span class="op">=</span><span class="st">"#8F8F8F"</span>, ha<span class="op">=</span><span class="st">"right"</span>))</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="pm_notebook_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display" data-execution_count="63">
<pre><code>&lt;ggplot: (80879219697)&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="test-set" class="level3">
<h3 class="anchored" data-anchor-id="test-set">Test Set</h3>
<p>All missing values will be imputed with their respective median value and all other feature transformation done on the train set will be used on the test set.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>ord_test <span class="op">=</span> test.sort_values(by<span class="op">=</span><span class="st">"Datetime"</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>add_df <span class="op">=</span> cfun.add_attributes(ord_test, drop_nan_value<span class="op">=</span><span class="va">False</span>, fill_nan_value<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>test_c <span class="op">=</span> add_df.fill_missing_value(fill_fun <span class="op">=</span> <span class="st">"median"</span>)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>test_c <span class="op">=</span> add_df.add_air_quality_index()</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>test_c <span class="op">=</span> add_df.add_period_variables(hour<span class="op">=</span><span class="va">True</span>, dayofyear<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>test_c <span class="op">=</span> test_c.drop([<span class="st">"ID"</span>, <span class="st">"Datetime"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>test_c <span class="op">=</span> full_pipeline.transform(test_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>final_model <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>final_prediction <span class="op">=</span> final_model.predict(test_c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>accuracy_score(samplesubmission[<span class="st">"Offset_fault"</span>], final_prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>0.7908621948634197</code></pre>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>confusion_matrix(samplesubmission[<span class="st">"Offset_fault"</span>], final_prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<pre><code>array([[100725,  26636],
       [     0,      0]], dtype=int64)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(samplesubmission[<span class="st">"Offset_fault"</span>], final_prediction))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       1.00      0.79      0.88    127361
           1       0.00      0.00      0.00         0

    accuracy                           0.79    127361
   macro avg       0.50      0.40      0.44    127361
weighted avg       1.00      0.79      0.88    127361
</code></pre>
</div>
</div>
<p>The test set seem to have an unusual task of predicting just one class which was the time the PM sensors where considered to have no offset faults. That been said, the model only detect that there were no fault in the sensor signal 79% of the time. Given that there are only 0s i.e non offset sensors we have a percision of 100%.</p>
<section id="store-fitted-model" class="level4">
<h4 class="anchored" data-anchor-id="store-fitted-model">Store Fitted Model</h4>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save Models</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"final_pm2.5_sensor_model.pkl"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    pickle.dump(final_model, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="function-to-read-and-predict-future-sensor-offsets" class="level4">
<h4 class="anchored" data-anchor-id="function-to-read-and-predict-future-sensor-offsets">Function to Read And Predict Future Sensor offsets</h4>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_predictions(model_file_path, new_data<span class="op">=</span><span class="va">None</span>, data_file_path<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co">    param: model_file_path: The file path to the pickle serialized file.</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co">    param: new_data: The new set of records.</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co">    param: data_file_path : The file path to the new set of records.</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="co">    return: pandas serise with predicted values.</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># data transformation</span></span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> function <span class="im">import</span> add_attributes</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> pandas <span class="im">import</span> Series</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> new_data <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>        mdl_data <span class="op">=</span> new_data</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data_file_path <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>        mdl_data <span class="op">=</span> data_file_path</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>    ord_rec <span class="op">=</span> mdl_data.sort_values(by<span class="op">=</span><span class="st">"Datetime"</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>    add_df <span class="op">=</span> add_attributes(ord_rec, drop_nan_value<span class="op">=</span><span class="va">False</span>, fill_nan_value<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>    rec_c <span class="op">=</span> add_df.fill_missing_value(fill_fun <span class="op">=</span> <span class="st">"median"</span>)</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>    rec_c <span class="op">=</span> add_df.add_air_quality_index()</span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>    rec_c <span class="op">=</span> add_df.add_period_variables(hour<span class="op">=</span><span class="va">True</span>, dayofyear<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>    rec_c <span class="op">=</span> rec_c.drop([<span class="st">"ID"</span>, <span class="st">"Datetime"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>    rec_c <span class="op">=</span> full_pipeline.transform(rec_c)</span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Load model</span></span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(model_file_path, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> pickle.load(f)</span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate predictions</span></span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a>    y_preds <span class="op">=</span> model.predict(rec_c)</span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># keep predictions in a pandas series</span></span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a>    y_preds <span class="op">=</span> Series(y_preds, index<span class="op">=</span>ord_rec[<span class="st">"ID"</span>], name<span class="op">=</span><span class="st">"pm2.5_sensor_offsets"</span>)</span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> y_preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Ayomide Akinwande. September, 2022</div>   
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>