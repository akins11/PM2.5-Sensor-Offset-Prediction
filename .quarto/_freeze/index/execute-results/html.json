{
  "hash": "5f29fdaa94d1b9130c6bcbbf033bf377",
  "result": {
    "markdown": "---\ntitle: Data & Exploration\n---\n\n### Introduction\nA PM<sub>2.5</sub> sensor measures the level of fine particulate matter (pm<sub>2.5</sub>) within of a specific area by detecting the air quality, these sensors can be prone to faults due to so many reasons which can affect the quality of its signal and data. It is important to quickly detect when such device is faulty so repairs or replacement can be carried out. *NOTE*: PM<sub>2.5</sub> also called Fine particulate matter are tiny particles in the air that reduce visibility and cause the air to appear hazy when levels are elevated. (PM<sub>2.5</sub> are complex because they can be made up of numerous types of chemicals and particles and they can also be partly liquid. measured in micrograms per cubic meter. \"a microgram is a unit of weight, there are a million micrograms in a gram & a pound = 450 grams.\"   \n\nIn order to effectively detect any future defects, we will train a model that can differentiate between a working sensor and an distorted sensor. Given the avaliable sensor historical data and the avaliability of the sensor fault label (Whether the sensor has a fault or not), The approprate model to use will be a `supervised classification model`.\n\n\n### Libraries\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\n\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as mticker\nimport seaborn as sns\nfrom plotnine import *\n```\n:::\n\n\n##### Custom Functions\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\nimport function as cfun\n```\n:::\n\n\n<p> \nAll custom functions used for the analysis can be found here <a href = \"www.mysite.com\"><i class=\"bi bi-filetype-py\"></i></a>\n</p>\n\n\n### Data\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\ntrain = pd.read_csv('data/train.csv', parse_dates = ['Datetime'])\n```\n:::\n\n\n#### Variable Definition\n**Sensor1_PM2.5, Sensor2_PM2.5**:: These are recorded PM2.5 from Sensor 1 and Sensor 2.      \n\n**Temparature** :: This is the degree or indensity of heat present when each PM2.5 was recorded using a Celsius scale. Note that higher tempemperature leads to low air quality. Also When the weather is hot primary sources of pollutants tend to increase.    \n \n**Relative_Humidity** :: Relative humidity is the amount of water vapor in the air, expressed as a percentage of the maximum amount of water vapor the air can hold at the same temperature. A high humidity increases the rate of harmful or toxic chemicals in the air.   \n\n\n#### Data Inspection\n\n###### Data Info\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\ntrain.info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<class 'pandas.core.frame.DataFrame'>\nRangeIndex: 297177 entries, 0 to 297176\nData columns (total 7 columns):\n #   Column             Non-Null Count   Dtype         \n---  ------             --------------   -----         \n 0   ID                 297177 non-null  object        \n 1   Datetime           297177 non-null  datetime64[ns]\n 2   Sensor1_PM2.5      293563 non-null  float64       \n 3   Sensor2_PM2.5      293563 non-null  float64       \n 4   Temperature        293628 non-null  float64       \n 5   Relative_Humidity  293628 non-null  float64       \n 6   Offset_fault       297177 non-null  int64         \ndtypes: datetime64[ns](1), float64(4), int64(1), object(1)\nmemory usage: 15.9+ MB\n```\n:::\n:::\n\n\nThere are 297,177 records and 7 variables of airquality data in the training data set, also the non null count shows that tamperature, relative humidity and both sensors have missing values in them.\n\n\n###### Missing Values\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nna_df = train.isnull().sum().to_frame().rename(columns = {0: \"Number of Missing Value\"})\nna_df[\"percentage\"] = round((na_df[\"Number of Missing Value\"] / train.shape[0])*100, 3)\nna_df\n```\n\n::: {.cell-output .cell-output-display execution_count=43}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Number of Missing Value</th>\n      <th>percentage</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>ID</th>\n      <td>0</td>\n      <td>0.000</td>\n    </tr>\n    <tr>\n      <th>Datetime</th>\n      <td>0</td>\n      <td>0.000</td>\n    </tr>\n    <tr>\n      <th>Sensor1_PM2.5</th>\n      <td>3614</td>\n      <td>1.216</td>\n    </tr>\n    <tr>\n      <th>Sensor2_PM2.5</th>\n      <td>3614</td>\n      <td>1.216</td>\n    </tr>\n    <tr>\n      <th>Temperature</th>\n      <td>3549</td>\n      <td>1.194</td>\n    </tr>\n    <tr>\n      <th>Relative_Humidity</th>\n      <td>3549</td>\n      <td>1.194</td>\n    </tr>\n    <tr>\n      <th>Offset_fault</th>\n      <td>0</td>\n      <td>0.000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nBoth PM<sub>2.5</sub> sensor have 3,614 missing values which is 1.2% of the train data set, while both tempaerature and relative humidity have 3,549 (1.2%) of missing data.\n\n\n###### Question: \nThere are similar missing number of values for both sensors and also temperature and relative humidity, so are these missing records similar in the data.\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\ndef related_missing_record(df, cols):\n    check_1 = df.loc[df[cols[0]].isna()].loc[df[cols[1]].notna()].shape[0]\n    check_2 = df.loc[df[cols[1]].isna()].loc[df[cols[0]].notna()].shape[0]\n    return check_1 == check_2\n\nprint(f\"Both Sensor ::\\n{related_missing_record(train, ['Sensor1_PM2.5', 'Sensor2_PM2.5'])}\\n\")\nprint(f\"Train Temperature & Relative Humidity::\\n{related_missing_record(train, ['Temperature', 'Relative_Humidity'])}\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nBoth Sensor ::\nTrue\n\nTrain Temperature & Relative Humidity::\nTrue\n\n```\n:::\n:::\n\n\nLooks like there were reasons/faliure for skipping data entry during a specific period of time for both sensors. let get the minimum and maximum date for this missing record.\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\nfor col in [\"Sensor1_PM2.5\", \"Temperature\"]:\n    print(f\"{col} ::\\n{train.loc[train[col].isna()]['Datetime'].agg(['min', 'max'])}\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSensor1_PM2.5 ::\nmin   2021-10-18 10:00:13\nmax   2021-10-22 14:58:43\nName: Datetime, dtype: datetime64[ns]\n\nTemperature ::\nmin   2021-10-30 11:00:31\nmax   2022-01-19 14:59:34\nName: Datetime, dtype: datetime64[ns]\n\n```\n:::\n:::\n\n\n###### Outliers\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\nsns.set_style(\"whitegrid\")\nfig, axes = plt.subplots(nrows = 2, ncols = 2, figsize = (10, 6))\nfig.suptitle('Variable Distribution', y = 0.93, fontsize = 16)\n\nfor ax, data, name in zip(axes.flatten(), train, ['Sensor1_PM2.5', 'Sensor2_PM2.5', 'Temperature', 'Relative_Humidity']):\n    sns.boxplot(train[name], ax = ax)\n    ax.set_xlabel(name)\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-10-output-1.png){width=802 height=530}\n:::\n:::\n\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\noutlier_cols = [\"Sensor1_PM2.5\", \"Sensor2_PM2.5\", \"Relative_Humidity\"]\n\nfor col in outlier_cols:\n    print(f\"{col} Outlier :: {cfun.get_outlier(train, col, 1.5)}\")\n    print(\"-\"*20)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSensor1_PM2.5 Outlier :: [-18.055, 89.905]\n--------------------\nSensor2_PM2.5 Outlier :: [-22.555000000000003, 89.64500000000001]\n--------------------\nRelative_Humidity Outlier :: [33.5, 125.5]\n--------------------\n```\n:::\n:::\n\n\nBoth Sensors have some extrem large values that shows that there where some times when the sensors picked up dengerous level of Fine particulate matter around the area.\n\n\n###### Question:\nAre these extreme values somehow related to the periods when the pm<sub>2.5</sub> sensors where condsidered faulty.\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\nfor col in [\"Sensor1_PM2.5\", \"Sensor2_PM2.5\"]:\n    print(f\"{col} Outlier :: {cfun.get_outlier(train.query('Offset_fault == 0'), col, 1.5, typ='upper')}\\n\")\n    print(f\"Max {col} value :: {train.query('Offset_fault == 0')[col].max()}\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSensor1_PM2.5 Outlier :: 92.72\n\nMax Sensor1_PM2.5 value :: 997.96\n\n\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nSensor2_PM2.5 Outlier :: 92.025\n\nMax Sensor2_PM2.5 value :: 997.26\n\n\n```\n:::\n:::\n\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\nfor col in [\"Sensor1_PM2.5\", \"Sensor2_PM2.5\"]:\n    print(f\"{col} Outlier :: {cfun.get_outlier(train.query('Offset_fault == 1'), col, 1.5, typ='upper')}\\n\")\n    print(f\"Max {col} value :: {train.query('Offset_fault == 1')[col].max()}\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nSensor1_PM2.5 Outlier :: 81.525\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nMax Sensor1_PM2.5 value :: 283.18\n\n\nSensor2_PM2.5 Outlier :: 71.0\n\nMax Sensor2_PM2.5 value :: 248.4\n\n\n```\n:::\n:::\n\n\nBoth occations show that the extreme values are present inspite of whether the sensor is considered faulty or not.\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\nfor col in outlier_cols:\n    print(f\"Number of Outlier in {col} is {cfun.filter_outlier(train, col, 'inner').shape[0]:,}\")\n    print(\"-\"*46)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNumber of Outlier in Sensor1_PM2.5 is 17,402\n----------------------------------------------\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nNumber of Outlier in Sensor2_PM2.5 is 15,463\n----------------------------------------------\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\nNumber of Outlier in Relative_Humidity is 772\n----------------------------------------------\n```\n:::\n:::\n\n\n#### Data Cleaning\nThe train data will be restructured for exploration.\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\ne_train = train.dropna().copy()\ne_train.shape\n```\n\n::: {.cell-output .cell-output-display execution_count=51}\n```\n(290014, 7)\n```\n:::\n:::\n\n\n### Exploratory Data Analysis\n\n#### Additional Variables\nThe sensors PM<sub>2.5</sub> records are numeric, a categorical variable will be created to distinguish this records for better data exploration.\n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\ne_train = cfun.add_pmCategory(e_train, ordinal=False)\n\nfor col in [\"S1_AQI\", \"S2_AQI\"]:\n    e_train[col] = e_train[col].astype(\"category\") \n    e_train[col] = e_train[col].cat.reorder_categories([\"Good\", \"Moderate\", \"Unhealthy (SG)\", \"Unhealthy\", \"Very Unhealthy\", \"Hazardous\"], ordered = True)\n```\n:::\n\n\nDefining Air Quality Index Categories:  \n1. **Good** :: Little to no risk (PM<sub>2.5</sub> from 0 - 12.0).    \n2. **Moderate** :: Unusually sensitive individuals may experience respiratory symptoms. (PM<sub>2.5</sub> from 21.1 - 35.4).  \n3. **Unhealthy** (for sensitive groups) :: Increasing likelihood of respiratory symptoms in sensitive individuals. (PM<sub>2.5</sub> from 35.5 - 55.4).    \n4. **Unhealthy** :: Increased respiratory effect in general population. (PM<sub>2.5</sub> from 55.5 - 150.4).    \n5. **Very Unhealthy** :: Significant increase in respiratory effect in general population. (PM<sub>2.5</sub> from 150.4 - 250.4).    \n6. **Hazardous** :: Serious risk of respiratory effect in general population (PM<sub>2.5</sub> from 250.4 - 500.4).  \n  \nsource: [U.S Environmental Protection Agency](https//www.epa.gov)\n\n<br>\nThe Datetime contains the timestamp of the data collection, from this variable the individual hour, month, and year will be extracted.\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\ne_train = cfun.get_standAlone_dates(e_train, \"Datetime\", [\"hour\", \"month\", \"year\"])\n```\n:::\n\n\nChanging offset fault for better readability during exploration.\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\ne_train[\"faulty\"] = e_train[\"Offset_fault\"].replace({0: \"No\", 1: \"Yes\"})\ne_train.head(3)\n```\n\n::: {.cell-output .cell-output-display execution_count=54}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>ID</th>\n      <th>Datetime</th>\n      <th>Sensor1_PM2.5</th>\n      <th>Sensor2_PM2.5</th>\n      <th>Temperature</th>\n      <th>Relative_Humidity</th>\n      <th>Offset_fault</th>\n      <th>S1_AQI</th>\n      <th>S2_AQI</th>\n      <th>Hour</th>\n      <th>Month</th>\n      <th>Year</th>\n      <th>faulty</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>ID_QF0ZTQJ2SF5Q</td>\n      <td>2021-11-03 04:06:31</td>\n      <td>52.58</td>\n      <td>49.52</td>\n      <td>17.4</td>\n      <td>96.0</td>\n      <td>0</td>\n      <td>Unhealthy (SG)</td>\n      <td>Unhealthy (SG)</td>\n      <td>4</td>\n      <td>11</td>\n      <td>2021</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>ID_4GTK689CNX5S</td>\n      <td>2021-11-08 18:43:23</td>\n      <td>35.25</td>\n      <td>33.40</td>\n      <td>25.0</td>\n      <td>75.0</td>\n      <td>0</td>\n      <td>Moderate</td>\n      <td>Moderate</td>\n      <td>18</td>\n      <td>11</td>\n      <td>2021</td>\n      <td>No</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>ID_DL7VVKW9U7XQ</td>\n      <td>2021-11-07 09:50:33</td>\n      <td>19.18</td>\n      <td>23.50</td>\n      <td>24.9</td>\n      <td>75.0</td>\n      <td>0</td>\n      <td>Moderate</td>\n      <td>Moderate</td>\n      <td>9</td>\n      <td>11</td>\n      <td>2021</td>\n      <td>No</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n<br>\n\n#### Univariate Analysis\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\ncfun.rec_count(e_train, \"faulty\", title = \"Device Status\", typ = \"plt\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-19-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=55}\n```\n<ggplot: (103465133075)>\n```\n:::\n:::\n\n\nThe outcome variable `offset fault`  contains only two categories which are 1/Yes for PM<sub>2.5</sub> sensor that was considered to have been sending faulty signals at the time and 0/No for sensors working well. From the bar chart above, there are less faulty sensors (36.95%) that faulty sensors (63.05%) overall.\n\n<br>\n\n::: {.cell execution_count=19}\n``` {.python .cell-code}\ne_train.select_dtypes(\"number\").describe().applymap(lambda x: round(x, 3))\n```\n\n::: {.cell-output .cell-output-display execution_count=56}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Sensor1_PM2.5</th>\n      <th>Sensor2_PM2.5</th>\n      <th>Temperature</th>\n      <th>Relative_Humidity</th>\n      <th>Offset_fault</th>\n      <th>Hour</th>\n      <th>Month</th>\n      <th>Year</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>290014.000</td>\n      <td>290014.000</td>\n      <td>290014.000</td>\n      <td>290014.000</td>\n      <td>290014.000</td>\n      <td>290014.000</td>\n      <td>290014.000</td>\n      <td>290014.000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>40.902</td>\n      <td>38.319</td>\n      <td>23.323</td>\n      <td>78.614</td>\n      <td>0.369</td>\n      <td>11.350</td>\n      <td>9.082</td>\n      <td>2021.208</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>28.598</td>\n      <td>28.723</td>\n      <td>3.842</td>\n      <td>14.792</td>\n      <td>0.483</td>\n      <td>6.969</td>\n      <td>4.195</td>\n      <td>0.406</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>-9.450</td>\n      <td>-9.700</td>\n      <td>16.700</td>\n      <td>27.000</td>\n      <td>0.000</td>\n      <td>0.000</td>\n      <td>1.000</td>\n      <td>2021.000</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>22.570</td>\n      <td>19.620</td>\n      <td>20.400</td>\n      <td>68.000</td>\n      <td>0.000</td>\n      <td>5.000</td>\n      <td>10.000</td>\n      <td>2021.000</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>36.650</td>\n      <td>33.850</td>\n      <td>21.900</td>\n      <td>84.000</td>\n      <td>0.000</td>\n      <td>11.000</td>\n      <td>11.000</td>\n      <td>2021.000</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>49.550</td>\n      <td>47.700</td>\n      <td>26.300</td>\n      <td>91.000</td>\n      <td>1.000</td>\n      <td>17.000</td>\n      <td>12.000</td>\n      <td>2021.000</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>997.960</td>\n      <td>997.260</td>\n      <td>34.900</td>\n      <td>99.000</td>\n      <td>1.000</td>\n      <td>23.000</td>\n      <td>12.000</td>\n      <td>2022.000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nIn micrograms per cubic meter the minimum value for sensors 1 and 2 falls within the range -9.45 to -9.70 respectively while that maximum value falls within the range 997.96 to 997.26 respectively which shows only a very small difference, for the average value given that there are huge presence of outliers in both sensors it will be more accurate to look at the median value where 50% for sensor 1 fall between 36.65 and lower also for sensor 2 33.85 and lower.  \n\nThere was an average temperature of  23.32 degrees overall for the train set and for relative humidity 78.61.\n\n<br>\n\n\n##### Sensor PM2.5 Distribution\n\n::: {.panel-tabset}\n\n## Sensor 1\n\n::: {.cell execution_count=20}\n``` {.python .cell-code}\ncfun.histPlot(e_train, \"Sensor1_PM2.5\", bins = 100, title=f\"Sensor 1 PM2.5\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-21-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=57}\n```\n<ggplot: (103462325792)>\n```\n:::\n:::\n\n\n## Sensor 2\n\n::: {.cell execution_count=21}\n``` {.python .cell-code}\ncfun.histPlot(e_train, \"Sensor2_PM2.5\", bins = 100, title=f\"Sensor 2 PM2.5\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-22-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=58}\n```\n<ggplot: (103469997618)>\n```\n:::\n:::\n\n\n:::\n\n\n\n##### Air Quality Index\n\n::: {.panel-tabset}\n\n## Sensor 1\n\n::: {.cell execution_count=22}\n``` {.python .cell-code}\ncfun.air_quality_count(e_train, \"S1_AQI\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-23-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=59}\n```\n<ggplot: (103474331354)>\n```\n:::\n:::\n\n\n## Sensor 2\n\n::: {.cell execution_count=23}\n``` {.python .cell-code}\ncfun.air_quality_count(e_train, \"S2_AQI\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-24-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=60}\n```\n<ggplot: (103467692831)>\n```\n:::\n:::\n\n\n:::\n\nSensor 2 Picked up more Good PM<sub>2.5</sub> signals (11.87%) than sensor 1 (8.51%), both sensors have just 0.03% of it recodes as hazadious while the highest Air quality index category recorded was moderate level with 39% and 41% respectively for sensor 1 and 2.\n\n\n##### Temperature\n\n::: {.cell execution_count=24}\n``` {.python .cell-code}\nprint(cfun.boxPlot(e_train, \"Temperature\"))\nprint(cfun.histPlot(e_train, \"Temperature\", bins=35))\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-25-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-25-output-3.png){}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n```\n:::\n:::\n\n\nGiven that the distibution is skewed, it shows that there are more low temperatures recorded then high temperatures.\n\n\n##### Relative Humidity\n\n::: {.cell execution_count=25}\n``` {.python .cell-code}\nprint(cfun.boxPlot(e_train, \"Relative_Humidity\", axis_text_suffix=\"%\"))\nprint(cfun.histPlot(e_train, \"Relative_Humidity\", bins=35, axis_text_suffix=\"%\"))\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-26-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-26-output-3.png){}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n```\n:::\n:::\n\n\nMore high relative humidity was recorded than low relative humidity Over the selected period.\n\n<br>\n\n##### DateTime\n\n::: {.cell execution_count=26}\n``` {.python .cell-code}\ne_train[\"Datetime\"].describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=63}\n```\ncount                  290014\nunique                 286694\ntop       2021-11-05 12:40:33\nfreq                        3\nfirst     2021-10-15 16:00:31\nlast      2022-01-21 07:34:57\nName: Datetime, dtype: object\n```\n:::\n:::\n\n\nFor the train data set the we can see that the records started from the 15th of October 2021 up to the 21st of january 2022.\n\n\n###### Month\n\n::: {.cell execution_count=27}\n``` {.python .cell-code}\ne_train[\"Month\"].unique()\n```\n\n::: {.cell-output .cell-output-display execution_count=64}\n```\narray([11,  1, 12, 10], dtype=int64)\n```\n:::\n:::\n\n\n::: {.cell execution_count=28}\n``` {.python .cell-code}\ncfun.rec_count(e_train, \"Month\", rename_axis_text = [\"January\", \"October\", \"November\", \"December\"])\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-29-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=65}\n```\n<ggplot: (103466907288)>\n```\n:::\n:::\n\n\n###### Year\n\n::: {.cell execution_count=29}\n``` {.python .cell-code}\ncfun.rec_count(e_train, \"Year\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-30-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=66}\n```\n<ggplot: (103469877957)>\n```\n:::\n:::\n\n\n<br> \n\n#### Multivarite Analysis\n\n##### Device Status and Particulate Matter \n\n::: {.panel-tabset}\n\n## Sensor 1\n\n::: {.cell execution_count=30}\n``` {.python .cell-code}\ncfun.boxPlot(e_train,  num_var=\"Sensor1_PM2.5\", cat_var=\"faulty\",\n            color=[\"#03B4C8\", \"#EE6A50\"],\n            title=[f\"particulate matter 2.5 From Sensor 1\", \"Device Status\"])\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-31-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=67}\n```\n<ggplot: (103473763097)>\n```\n:::\n:::\n\n\n## Sensor 2\n\n::: {.cell execution_count=31}\n``` {.python .cell-code}\ncfun.boxPlot(e_train,  num_var=\"Sensor2_PM2.5\", cat_var=\"faulty\",\n             color=[\"#03B4C8\", \"#EE6A50\"],\n             title=[f\"particulate matter 2.5 From Sensor 2\", \"Device Status\"])\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-32-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=68}\n```\n<ggplot: (103467692042)>\n```\n:::\n:::\n\n\n:::\nFor both sensors there are many extreme PM<sub>2.5</sub> values recorded when no faulty signals was detected than when it was.\n\n::: {.cell execution_count=32}\n``` {.python .cell-code}\nsen_agg = cfun.vars_longer_summary(e_train, \n                                   select_vars = [\"faulty\", \"Sensor1_PM2.5\", \"Sensor2_PM2.5\"], \n                                   var_name = \"Sensor\", value_name = \"PM 2.5\", \n                                   replace_rec = [\"Sensor 1\", \"Sensor 2\"])\n\nsummary_fun = [\"median\", \"max\"]\nplt_title = [\"Median\", \"Maximum\"]\n\nfor sumy_fun, plt_tl in zip(summary_fun, plt_title):\n    print(cfun.facet_summary_plot2(df = sen_agg, cat_var = \"faulty\", num_var = sumy_fun, \n                                  fill = \"faulty\", facet_by = \"Sensor\", \n                                  ylab = \"PM2.5\", \n                                  title = f\"{plt_tl} Particulate Matter By Offset Fault For Each Sensor\"))\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-33-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-33-output-3.png){}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n```\n:::\n:::\n\n\nThe Median PM<sub>2.5</sub> for sensor 2 when no signal offset fault was detected (61.93%) is higher than that of sensor 1 (55.31%) and the reverse is the case when a fault was detected. in conclusion sensor 1 had more offset faults than sensor 2.\n\n\n##### Temperature, Relative Humidity and Device status\n\n::: {.cell execution_count=33}\n``` {.python .cell-code}\ntr_agg = cfun.vars_longer_summary(e_train, \n                                  select_vars = [\"faulty\", \"Temperature\", \"Relative_Humidity\"],\n                                  var_name  = \"variable\", value_name = \"value\")\n\ncfun.facet_summary_plot2(\n    df=tr_agg, cat_var=\"faulty\", num_var=\"median\", \n    fill=\"faulty\", facet_by=\"variable\", scales=\"free_y\", \n    sb_aj=0.1, title=\"Median Of Temperature & Relative Humidity By Device Status\")                                 \n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-34-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=70}\n```\n<ggplot: (103460835782)>\n```\n:::\n:::\n\n\n##### Air Quality with Temperature & Relative Humidity\n\n::: {.panel-tabset}\n## Sensor 1\n\n::: {.cell execution_count=34}\n``` {.python .cell-code}\naqi_tr =  cfun.vars_longer_summary(e_train, \n                                   select_vars=[\"S1_AQI\", \"Temperature\", \"Relative_Humidity\"], \n                                   var_name   =\"Variable\", \n                                   value_name =\"PM2.5\")\n\ncfun.facet_summary_plot(\n    aqi_tr, \"S1_AQI\", \"mean\", \"Variable\", \n    sb_aj=0.06, \n    title=\"Average Relative Humidity & Temperature For Sensor 1 By Air Quality Index\")\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-35-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=71}\n```\n<ggplot: (103469961883)>\n```\n:::\n:::\n\n\n## Sensor 2\n\n::: {.cell execution_count=35}\n``` {.python .cell-code}\naqi_tr =  cfun.vars_longer_summary(e_train, \n                                   select_vars=[\"S2_AQI\", \"Temperature\", \"Relative_Humidity\"], \n                                   var_name   =\"Variable\", \n                                   value_name =\"PM2.5\")\n\ncfun.facet_summary_plot(\n    aqi_tr, \"S2_AQI\", \"mean\", \"Variable\", \n    sb_aj=0.06, \n    title=\"Average Relative Humidity & Temperature For Sensor 2 By Air Quality Index\"\n    )                                   \n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-36-output-1.png){}\n:::\n\n::: {.cell-output .cell-output-display execution_count=72}\n```\n<ggplot: (103347821319)>\n```\n:::\n:::\n\n\n:::\nFor relative humidity using the above chart the higher the critical level of PM<sub>2.5</sub> the higher the relative humidity on an average with the exception of hazardous level. while for temperature the higher the critical level of PM<sub>2.5</sub> the lower the degree of temperature on an average with only the exception of hazardous level.\n\n\n\n##### Correlation\n\n::: {.cell cache='true' execution_count=36}\n``` {.python .cell-code}\nplt.figure(figsize = (20, 6))\nnum_cols = ['Sensor1_PM2.5', 'Sensor2_PM2.5', 'Temperature', 'Relative_Humidity']\nsns.pairplot(e_train[num_cols], \n             kind=\"scatter\", \n             plot_kws=dict(s=80, edgecolor=\"white\", linewidth=2.5, color=\"#02A9EA\"))\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n```\n<Figure size 1920x576 with 0 Axes>\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-37-output-2.png){width=946 height=946}\n:::\n:::\n\n\n::: {.cell execution_count=37}\n``` {.python .cell-code}\n# Ordinal Encoding\ncorr_df = e_train.copy()\n\nfor col in [\"S1_AQI\", \"S2_AQI\"]:\n    corr_df[col] = corr_df[col].replace({\"Hazardous\"     : 0, \n                                         \"Very Unhealthy\": 1, \n                                         \"Unhealthy\"     : 2, \n                                         \"Unhealthy (SG)\": 3, \n                                         \"Moderate\"      : 4, \n                                         \"Good\"          : 5})\n    corr_df[col] = corr_df[col].astype(\"int64\")\n\ncor = corr_df.select_dtypes([\"int64\", \"float64\"]).corr()\n\nplt.figure(figsize = (10, 8))\nsns.heatmap(cor, cmap = 'RdYlBu', annot = True, center = 0)\nplt.title('Correlogram', fontsize = 15, color = 'darkgreen')\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-38-output-1.png){width=841 height=749}\n:::\n:::\n\n\nBoth sensors 1 & 2 are highly (positive) correlated with each other.  \nAir quality index(AQI) from both sensors are negatively correlated with the PM<sub>2.5</sub> values.    \nTemperature have a positive correlation with AQI while Relative Humidity have a negative correlation with AQI.\n\n",
    "supporting": [
      "index_files\\figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}